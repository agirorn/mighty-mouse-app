var module = angular.module('clientApp');
module.directive('documentFastclick', ['$parse', '$document', function ($parse, $document) {
    return function (scope, element, attr) {
        var fn = $parse(attr['documentFastclick']);
        var initX, initY, endX, endY;
        var elem = angular.element($document);
        var maxMove = 4;

        elem.bind('touchstart', function (event) {
            event.preventDefault();
            console.log(event);
            console.log(arguments);

            initX = endX = event.clientX;
            initY = endY = event.clientY;

            elem.bind('touchend', onTouchEnd);
            elem.bind('touchmove', onTouchMove);
        });

        function onTouchMove(event) {
            endX = event.clientX;
            endY = event.clientY;
        };

        function onTouchEnd(event) {
            elem.unbind('touchmove');
            elem.unbind('touchend');
            if (Math.abs(endX - initX) > maxMove) return;
            if (Math.abs(endY - initY) > maxMove) return;
            console.log('ccccc');
            console.log('the fn:' + fn({}, {}));
            scope.$apply(function () { fn(scope, { $event: event }); });
        };
    };
} ]);
